image: maven:3.5.4-jdk-8-alpine
    
variables:
  MAVEN_OPTS:
  MAVEN_CLI_OPTS: "--settings settings.xml --batch-mode"

cache:
  paths:
    - ./.m2/repository
  # keep cache across branch
  key: "$CI_BUILD_REF_NAME"

stages:
  - build
  - test
  - deploy

build:
  stage: build
  script:
    - "mvn $MAVEN_CLI_OPTS compile"
    
it-build:
  stage: build
  dependencies:
    - build
  script:
    - "mvn $MAVEN_CLI_OPTS compile -f monticore-generator/it/pom.xml"

test:
  stage: test
  dependencies:
    - build
  script:
    - "mvn $MAVEN_CLI_OPTS test"

it-test:
  stage: test
  dependencies:
    - it-build
  script:
    - "mvn $MAVEN_CLI_OPTS test -f monticore-generator/it/pom.xml"

# deploy:
#   stage: deploy
#   artifacts:
#     paths:
#       - "target/*.jar"