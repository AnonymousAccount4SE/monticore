/* (c) https://github.com/MontiCore/monticore */
description = 'MontiTrans Test: Generated DSTL Test'

def _outputDir = "$buildDir/generated-sources"

dependencies {
  implementation project(':monticore-test:montitrans:test-dstl-gen')
}

task generateStatechartTRRules {
  group = "montitrans"
}
fileTree(dir: "$projectDir/src/main/models/statechart/mtr", include: '**/**.mtr').each {
  def g = it
  def taskname = "generateStatechartTRRules${it.getName().substring(0, it.getName().lastIndexOf('.'))}"
  task "$taskname"(type: MontiTransExec) {
    getClassPath().setFrom(project(':monticore-test:montitrans:test-dstl-gen').sourceSets.main.runtimeClasspath)
    TFGenTool = 'mc.testcases.statechart.tr.StatechartTFGenTool'
    input = file(g)
    outputDir = file("$buildDir/generated-sources")
  }
  generateStatechartTRRules.dependsOn("$taskname")
}

task generateSocialNetworkTRRules {
  group = "montitrans"
}
fileTree(dir: "$projectDir/src/main/models/social/mtr", include: '**/**.mtr').each {
  def g = it
  def taskname = "generateSocialNetworkTRRules${it.getName().substring(0, it.getName().lastIndexOf('.'))}"
  task "$taskname"(type: MontiTransExec) {
    getClassPath().setFrom(project(':monticore-test:montitrans:test-dstl-gen').sourceSets.main.runtimeClasspath)
    TFGenTool = 'mc.testcases.social.tr.SocialNetworkTFGenTool'
    input = file(g)
    outputDir = file("$buildDir/generated-sources")
  }
  generateSocialNetworkTRRules.dependsOn("$taskname")
}

task generateExpressionDSLTRRules {
  group = "montitrans"
}
fileTree(dir: "$projectDir/src/main/models/expressiondsl/mtr", include: '**/**.mtr').each {
  def g = it
  def taskname = "generateExpressionDSLTRRules${it.getName().substring(0, it.getName().lastIndexOf('.'))}"
  task "$taskname"(type: MontiTransExec) {
    getClassPath().setFrom(project(':monticore-test:montitrans:test-dstl-gen').sourceSets.main.runtimeClasspath)
    TFGenTool = 'mc.testcases.tr.ExpressionDSLTFGenTool'
    input = file(g)
    outputDir = file("$buildDir/generated-sources")
  }
  generateExpressionDSLTRRules.dependsOn("$taskname")
}


compileJava {
  dependsOn "generateStatechartTRRules", "generateSocialNetworkTRRules", "generateExpressionDSLTRRules"
}

sourceSets {
  main.java.srcDirs += [ _outputDir ]
}
